# Вариант 1: Веб-дашборд на Streamlit — подробно

## Идея

Один веб-интерфейс (страница в браузере), где ты выбираешь период (неделя / месяц / свои даты), нажимаешь «Обновить» — и видишь: сколько ссылок разместил каждый сотрудник, по каким проектам и матрицу «сотрудник × проект». Данные подтягиваются из четырёх Google Таблиц через API (или через экспорт в CSV, если API не использовать).

---

## Технологии

| Компонент | Что используем |
|-----------|----------------|
| Язык | Python 3.10+ |
| Интерфейс | **Streamlit** — одна страница с виджетами, таблицами и графиками |
| Графики | **Plotly** (или встроенный `st.bar_chart`) — столбчатые и при желании круговые |
| Данные из Google | **Google Sheets API** (библиотека `gspread` или `google-api-python-client`) — те же учётные данные, что и для MCP; либо ручной экспорт листов в CSV и загрузка файлов в дашборд |
| Запуск | Локально: `streamlit run app.py`; при желании — выкладка на Streamlit Cloud или свой сервер |

Зависимости: `streamlit`, `pandas`, `plotly`, `gspread` (или `google-api-python-client`), при необходимости `python-dotenv` для ключей.

---

## Откуда берутся данные

Данные читаются из **четырёх таблиц** и **четырёх листов**:

1. **MR Anchors** — лист «СНГ Outreach», колонки: Status, Проект, Версия, Линкбилдер, Дата публикации.
2. **Основная РФ и СНГ** — лист «Размещенные ссылки», колонки: Проект, Версия, Линкбилдер, Дата публикации (статус при наличии).
3. **TelecomAsia Anchors** — лист «Outreach», колонки: Project, Версия проекта, Linkbuilder, Status, Date of posting.
4. **International Linkbuilding** — лист «Posted links», колонки: Project, Версия проекта, Linkbuilder, Status, Date of posting.

Для каждой строки мы приводим к одному формату:

- **employee** — имя сотрудника (Линкбилдер / Linkbuilder).
- **project** — проект + версия, например `Metaratings KZ`, `Telecomasia.net KE`.
- **date** — дата размещения (парсим из «Дата публикации» / «Date of posting»).
- **source** — из какой таблицы строка (для отладки и фильтров).

Учитываем только строки со статусом **«Готово»** (в таблицах 1, 3, 4); в таблице 2 — все строки листа «Размещенные ссылки» или по статусу, если колонка есть.

---

## Период: неделя и месяц

- **Неделя** — последние 7 дней от сегодня (или от выбранной «конечной» даты).
- **Месяц** — текущий календарный месяц (или выбранный месяц из списка).
- **Произвольный диапазон** — дата «с» и дата «по»; фильтруем строки по полю `date`.

Все даты парсятся из ячеек (форматы типа `DD.MM.YYYY`, `YYYY-MM-DD` и т.п.) и приводятся к одному виду для сравнения.

---

## Структура страницы (по блокам)

### 1. Верхняя панель — фильтры

- **Тип периода:** выпадающий список: «Неделя», «Месяц», «Произвольный период».
- Если выбран «Месяц» — дополнительно выбор месяца и года (или «текущий месяц»).
- Если «Произвольный период» — два поля даты: «С» и «По».
- Кнопка **«Обновить данные»** — перечитывает таблицы (или CSV), применяет фильтр по периоду и пересчитывает все блоки ниже.
- Опционально: чекбоксы «Учитывать таблицу MR», «Учитывать Основную», «TelecomAsia», «International» — чтобы временно отключить одну из таблиц.

### 2. Блок «По сотрудникам»

- **Таблица:** столбцы [Сотрудник | Количество ссылок].
- Строки отсортированы по количеству (по убыванию).
- Рядом или под таблицей — **столбчатая диаграмма** (горизонтальная): по оси — имена сотрудников, по оси — число ссылок. Цвет можно задать один на весь дашборд или градиент по значению.

### 3. Блок «По проектам»

- **Таблица:** [Проект | Количество ссылок], сортировка по убыванию.
- **График:** столбчатый или круговой — распределение ссылок по проектам за выбранный период.

### 4. Блок «Матрица: сотрудник × проект»

- **Таблица:** строки — сотрудники, столбцы — проекты (уникальные значения из данных за период). В ячейке — число размещений данного сотрудника по данному проекту.
- Последний столбец — **Итого** по строке (всего ссылок у сотрудника за период).
- При большом числе проектов — горизонтальный скролл или свёрнутые в «Другие» мелкие проекты (опционально).

### 5. Блок «Последние размещения» (опционально)

- Таблица: Дата | Сотрудник | Проект | Сайт/URL материала (если есть в исходных листах).
- Ограничение: например, последние 50–100 записей за выбранный период.
- Доп. фильтр по сотруднику или проекту — выпадающие списки.

---

## Как будет выглядеть интерфейс (пример)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  Дашборд: размещения ссылок по сотрудникам и проектам                    │
├─────────────────────────────────────────────────────────────────────────┤
│  Период:  [Неделя ▼]   или  [Месяц: январь 2026 ▼]   или  [С 01.01 по 31.01] │
│  [Обновить данные]                                                        │
│  Таблицы: [✓] MR  [✓] Основная  [✓] TelecomAsia  [✓] International      │
└─────────────────────────────────────────────────────────────────────────┘

┌─ По сотрудникам ─────────────────────┐  ┌─ Диаграмма ──────────────────┐
│ Сотрудник           │ Ссылок         │  │  Feruza Z.     ███████████ 62  │
│ Feruza Zakirkhodjaeva │ 62            │  │  Oleg T.       ████████ 45     │
│ Oleg Tsebulevskiy   │ 45             │  │  Tatyana K.    ██████ 38       │
│ Tatyana Khardina    │ 38             │  │  Anzhela A.    █████ 28        │
│ Anzhela Arakelyan   │ 28             │  │  ...                           │
└──────────────────────────────────────┘  └───────────────────────────────┘

┌─ По проектам ────────────────────────┐  ┌─ Круговая или столбцы ────────┐
│ Проект                 │ Ссылок       │  │  [график по проектам]          │
│ Telecomasia.net ZA     │ 85           │  │                               │
│ Telecomasia.net KE     │ 62           │  │                               │
│ Metaratings KZ         │ 44           │  │                               │
│ ...                    │              │  │                               │
└──────────────────────────────────────┘  └───────────────────────────────┘

┌─ Матрица: сотрудник × проект ────────────────────────────────────────────┐
│              │ TA ZA │ TA KE │ MR KZ │ MR BY │ ... │ Итого │
│ Feruza Z.    │  34   │  20   │   5   │   3   │     │  62   │
│ Oleg T.      │  10   │  15   │  12   │   8   │     │  45   │
│ Tatyana K.   │   8   │   6   │  14   │  10   │     │  38   │
└──────────────────────────────────────────────────────────────────────────┘

┌─ Последние размещения (топ-20) ──────────────────────────────────────────┐
│ Дата       │ Сотрудник   │ Проект           │ Сайт / материал            │
│ 02.02.2026 │ Oleg T.     │ Telecomasia ZA   │ offblogmedia.com/...        │
│ ...        │             │                  │                            │
└──────────────────────────────────────────────────────────────────────────┘
```

Цвета и шрифты можно оставить стандартными Streamlit или задать свою тему в `.streamlit/config.toml`.

---

## Поток данных (по шагам)

1. **Загрузка**  
   - Либо через Google Sheets API: для каждой из 4 таблиц запрашиваем нужный лист целиком (или диапазон с запасом по строкам).  
   - Либо читаем 4 CSV (экспорт тех же листов) из папки или загружаем через `st.file_uploader`.

2. **Нормализация**  
   - Для каждого листа по маппингу колонок (см. основной proposal) формируем общие поля: `employee`, `project`, `date`, `source`.  
   - Парсим даты; некорректные пропускаем или помечаем.

3. **Фильтрация**  
   - Оставляем только статус «Готово» где он есть.  
   - Отбираем строки, у которых `date` попадает в выбранный период (неделя / месяц / диапазон).

4. **Агрегаты**  
   - По сотруднику: `df.groupby('employee').size()`.  
   - По проекту: `df.groupby('project').size()`.  
   - Матрица: `df.pivot_table(index='employee', columns='project', aggfunc='size', fill_value=0)`.

5. **Отрисовка**  
   - В Streamlit: `st.dataframe` для таблиц, `st.bar_chart` или Plotly для графиков, при необходимости `st.expander` для «Последние размещения».

---

## Структура проекта (пример)

```
anchor_checker/
  app/
    dashboard/
      app.py              # точка входа: streamlit run app/dashboard/app.py
      data_loader.py      # загрузка из Google Sheets или CSV, нормализация
      filters.py          # период (неделя/месяц/диапазон), фильтр по таблицам
      aggregates.py       # подсчёт по сотрудникам, проектам, матрица
      charts.py           # построение графиков (plotly/bar_chart)
  .env                    # GOOGLE_CREDENTIALS или путь к service account (не в git)
  requirements-dashboard.txt  # streamlit, pandas, plotly, gspread, ...
```

Либо один файл `app.py` на 200–300 строк, если не хочется дробить.

---

## Запуск и деплой

- **Локально:**  
  `pip install -r requirements-dashboard.txt`  
  `streamlit run app/dashboard/app.py`  
  В браузере откроется страница (обычно `http://localhost:8501`).

- **Streamlit Cloud:**  
  Репозиторий с проектом подключаешь к [share.streamlit.io](https://share.streamlit.io), в настройках добавляешь секреты (путь к JSON ключу или сам JSON). При каждом открытии приложения данные запрашиваются из таблиц заново.

- **Свой сервер:**  
  Запуск через `streamlit run` с опцией `--server.port` и при необходимости за reverse proxy (nginx) с HTTPS.

---

## Резюме по варианту 1

| Аспект | Описание |
|--------|----------|
| Что делаем | Один веб-дашборд на Streamlit с фильтром по периоду (неделя/месяц/диапазон). |
| Откуда данные | Четыре Google Таблицы (те же листы, что в proposal), через API или CSV. |
| Что показываем | По сотрудникам, по проектам, матрица сотрудник×проект, опционально список последних размещений. |
| Реализация | Python, Streamlit, pandas, при желании Plotly; отдельные модули загрузки, фильтров и агрегатов. |
| Запуск | Локально или на Streamlit Cloud / своём сервере. |

Если нужно, следующий шаг — набросать скелет `app.py` и `data_loader.py` под твои четыре таблицы и листы (с конкретными ID таблиц и именами листов).

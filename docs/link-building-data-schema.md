# Структура данных для панели мониторинга ссылок

Цель: объединить данные из 4 Google Sheets в один набор и анализировать эффективность за выбранный период. Разные люди работают с одними и теми же таблицами.

---

## 1. Унифицированная схема (каноническая модель)

Одна строка = одна обратная ссылка. Все 4 файла приводятся к этой схеме через маппинг колонок.

### Обязательные поля (без них объединение и фильтр по датам невозможны)

| Поле (ID) | Тип | Описание | Пример |
|-----------|-----|----------|--------|
| **source_file** | string | Идентификатор файла/источника (откуда строка) | `sheet_1`, `campaign_alfa`, ID таблицы |
| **date** | date | Дата, к которой относится ссылка (размещение, проверка, учёт) | 2025-01-15 |
| **page_url** | string | URL страницы, где стоит ссылка | https://site.com/article |
| **target_url** | string | URL, на который ведёт ссылка | https://mysite.com/page |
| **anchor** | string | Текст анкора | купить слона |

### Рекомендуемые поля (для анализа эффективности)

| Поле (ID) | Тип | Описание | Пример |
|-----------|-----|----------|--------|
| **found** | enum | Результат проверки: ссылка на месте? | `Yes`, `No`, `Error`, пусто |
| **index_status** | string | Индексация страницы (опционально) | indexed, not_indexed, unknown |
| **placement_date** | date | Дата размещения (если отличается от основной даты) | 2025-01-10 |

### Опциональные поля (если есть в ваших таблицах)

| Поле (ID) | Тип | Описание | Пример |
|-----------|-----|----------|--------|
| **project** / **campaign** | string | Проект или кампания | БК, Ритейл |
| **author** / **responsible** | string | Кто вёл задачу / кто добавил строку | Иванов, команда А |
| **cost** | number | Стоимость размещения | 5000 |
| **dr** / **da** | number | Метрики донора (если считаете) | 35, 42 |
| **notes** | string | Заметки | Договорились об правке |
| **row_id** | string | Уникальный ID строки в исходной таблице (для обновлений) | sheet_2_row_15 |

---

## 2. Правила объединения

- **source_file** — у каждой строки после объединения: по нему можно фильтровать «только из таблицы 2» и считать вклад по источникам.
- **date** — единое поле даты для фильтра «период с … по …». Если в разных файлах колонки называются по-разному (Дата, Date, Размещено, Проверено), маппим все в **date**. Если есть и дата размещения, и дата проверки — решаем, какая из них основная для отчёта (чаще всего дата размещения или дата проверки).
- Пустые ячейки → пустая строка или `null` в унифицированной модели; даты невалидные лучше помечать отдельно (например, отдельный флаг или вынести в «без даты»).

---

## 3. Что нужно от вас для следующего шага

Чтобы зафиксировать маппинг и не «ломать» визуализации при разных названиях колонок:

1. **Список колонок по каждому из 4 файлов**  
   Например:  
   - Файл 1: `Page URL`, `Target URL`, `Exact Anchor`, `Found`, `Дата`  
   - Файл 2: `URL страницы`, `Куда ведёт`, `Анкор`, `Проверка`, `Дата проверки`  
   и т.д.

2. **Какая дата главная для отчёта**  
   Одна дата на строку в канонической схеме: это дата размещения, дата проверки или последнего обновления?

3. **Как различать 4 файла**  
   Как вам удобнее: короткие имена (`sheet_1`, `sheet_2`), названия таблиц из Google Sheets или ID таблиц?

4. **Есть ли в таблицах колонки «кто вёл» / «проект» / «стоимость»**  
   Перечислите названия — добавим их в маппинг как опциональные поля.

После этого можно описать маппинг (какая колонка какого файла → какое поле схемы) и переходить к способу объединения (скрипт, BigQuery, Looker Studio и т.д.) без лишних переделок структуры.
